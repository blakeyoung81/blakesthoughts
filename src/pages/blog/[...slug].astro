---
import { getCollection, getEntry } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

export async function getStaticPaths() {
	const posts = await getCollection('blog');
	return posts.map((post) => ({
		params: { slug: post.id.replace(/\.(md|mdx)$/, '') },
	}));
}

const { slug } = Astro.params;
const post = await getEntry('blog', slug);

let Content;
let contentError = null;

if (!post) {
	contentError = "This post could not be found."
} else {
    try {
        const result = await post.render();
        Content = result.Content;
    } catch (error) {
        contentError = error.message;
        console.error('Content rendering error for', post.id, ':', error);
    }
}
---

<BaseLayout title={post?.data.title ?? 'Post Not Found'}>
	<article class="max-w-3xl mx-auto px-4 py-8">
		{post ? (
			<>
				<h1 class="text-4xl font-bold mb-4">{post.data.title}</h1>
				<p class="text-lg text-gray-300 mb-4">{post.data.description}</p>
				<p class="text-sm text-gray-500">Published: {new Date(post.data.pubDate).toLocaleDateString()}</p>
				
				<div class="mt-8">
					{contentError ? (
						<div class="bg-red-900/20 border border-red-500 text-red-200 p-4 rounded-lg">
							<h3 class="font-bold">Content Rendering Error:</h3>
							<p>{contentError}</p>
						</div>
					) : (
						<div class="prose prose-lg prose-invert max-w-none">
							<Content />
						</div>
					)}
				</div>
			</>
		) : (
			<div class="text-center py-20">
				<h1 class="text-4xl font-bold mb-4">Post Not Found</h1>
                <p class="text-lg text-gray-300">Sorry, we couldn't find the post you were looking for.</p>
			</div>
		)}
		
		<div class="mt-8 pt-8 border-t border-gray-700">
			<a href="/blog" class="text-blue-400 hover:text-blue-300">‚Üê Back to all posts</a>
		</div>
	</article>
</BaseLayout>
