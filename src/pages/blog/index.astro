---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

const allBlogPosts = await getCollection('blog', ({ data }) => {
	return import.meta.env.PROD ? !data.draft : true;
});

// Sort posts by date in descending order
const sortedPosts = allBlogPosts.sort(
	(a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime()
);

// Format date function
const formatDate = (date) => {
	return new Date(date).toLocaleDateString('en-US', {
		year: 'numeric',
		month: 'long',
		day: 'numeric'
	});
};
---

<BaseLayout title="Blog">
	<div class="max-w-4xl mx-auto">
		<div class="mb-12">
			<h1 class="text-4xl font-bold mb-4">Blog</h1>
			<p class="text-xl text-zinc-700 dark:text-zinc-300">
				Essays, reflections, and insights on medicine, technology, and their intersection.
			</p>
		</div>
		
		<div class="space-y-12">
			{sortedPosts.map((post) => (
				<article class="border-b border-zinc-200 dark:border-zinc-800 pb-8 last:border-0">
					<h2 class="text-2xl font-bold mb-2">
						<a href={`/blog/${post.slug}`} class="hover:text-accent transition">
							{post.data.title}
						</a>
					</h2>
					
					<div class="flex items-center text-sm text-zinc-500 mb-4">
						<time datetime={post.data.pubDate.toISOString()}>
							{formatDate(post.data.pubDate)}
						</time>
						{post.data.draft && 
							<span class="ml-3 bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-100 px-2 py-1 rounded text-xs">
								Draft
							</span>
						}
					</div>
					
					<p class="text-zinc-600 dark:text-zinc-400 mb-4">
						{post.data.description}
					</p>
					
					<a href={`/blog/${post.slug}`} class="text-accent hover:underline inline-flex items-center">
						Read more
						<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" class="ml-1">
							<path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
						</svg>
					</a>
				</article>
			))}
		</div>
	</div>
</BaseLayout>
